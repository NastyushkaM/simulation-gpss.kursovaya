	SIMULATE
	REALLOCATE COM,32720 	* выделение памяти для работы модели
 
 1 FUNCTION RN1,D3  		* время обработки на ARMi
 .1,16/.8,25/1,30	

 2 FUNCTION P1,E3  		* обработка на KMM
 1,2/2,3/3,FN3

 3 FUNCTION RN1,D2  		* время обработки tk3
 .2,3/1,1

 4 FUNCTION P1,E3		* переходы с КММ на RTERi
 1,RTER1/2,RTER2/3,RTER3
	
	GENERATE 120,5,,57,10
	ASSING 1,1           	* P1 = 1 (идентификатор терминала 1)

RTER1	TEST E P2,1,TERM1   	* проверка обработалась ли заявка на ЦВК
	SAVEVALUE RET1+,1 	* сколько заявок вернулось с ЦВК
	SAVEVALUE CNTRET1+,1	* счетчик для определения завершения (каждая 5-ая)
	TEST E X$CNTRET1,5,TERM1
	SAVEVALUE CNTRET1,0	* сброс счетчика 
	ASSING 3,1		* параметр для идентификации заявки, которую надо удалить

TERM1   QUEUE QTERM1
	SEIZE TERM1
	DEPART QTERM1
	PRIORITY 10		* выравнивание приоритета заявки перед поступлением на АРМ
	ADVANCE 30,10
	RELEASE TERM1
	SAVEVALUE OBRT1+,1	* счетчик обработанных на терминале 1 заявок
	ASSIGN 2,0		* обнуляется 2-ой параметр
	TRANSFER ,ARM1

ARM1    QUEUE QARM1
	SEIZE ARM1
	DEPART QARM1
	ADVANCE FN1 
	RELEASE ARM1
	TEST E P3,1,MET2
	SAVEVALUE TRMNT1+,1	* счетчик завершенных заявок
	TRANSFER ,TRMN		* переход к завершению
MET2	TRANSFER .7,MET,RTER1	* с вероятностью 70% на терминал, иначе на KMM


	GENERATE 200,,,18,10
	ASSING 1,2           	* P1 = 2 (идентификатор терминала 2)

RTER2	TEST E P2,1,TERM2	* проверка обработалась ли заявка на ЦВК
	SAVEVALUE RET2+,1	* сколько заявок вернулось с ЦВК
	SAVEVALUE CNTRET2+,1	* счетчик для определения завершения (каждая 4-ая)
	TEST E X$CNTRET2,4,TERM2
	SAVEVALUE CNTRET2,0	* сброс счетчика
	ASSING 3,1

TERM2   QUEUE QTERM2
	SEIZE TERM2
	DEPART QTERM2
	PRIORITY 10	 	* выравнивание приоритета заявки перед поступлением на АРМ
	ADVANCE 33,5
	RELEASE TERM2
	SAVEVALUE OBRT2+,1	* счетчик обработанных на терминале 2 заявок
	ASSIGN 2,0	 	* обнуляется 2-ой параметр
	TRANSFER ,ARM2

ARM2    QUEUE QARM2
	SEIZE ARM2
	DEPART QARM2
	ADVANCE FN1 
	RELEASE ARM2
	TEST E P3,1,MET3
	SAVEVALUE TRMNT2+,1	* счетчик завершенных заявок
	TRANSFER ,TRMN		* переход к завершению
MET3	TRANSFER .7,MET,RTER2	* с вероятностью 70% на терминал, иначе на KMM


	GENERATE 90,15,,45,10
	ASSING 1,3           	* P1 = 3 (идентификатор терминала 3)

RTER3	TEST E P2,1,TERM3	* проверка обработалась ли заявка на ЦВК
	SAVEVALUE RET3+,1	* сколько заявок вернулось с ЦВК
	SAVEVALUE CNTRET3+,1	* счетчик для определения завершения (каждая 3-ая)
	TEST E X$CNTRET3,3,TERM3
	SAVEVALUE CNTRET3,0	* сброс счетчика
	ASSING 3,1

TERM3   QUEUE QTERM3
	SEIZE TERM3
	DEPART QTERM3
	PRIORITY 10		* выравнивание приоритета заявки перед поступлением на АРМ
	ADVANCE 35,12
	RELEASE TERM3
	SAVEVALUE OBRT3+,1	* счетчик обработанных на терминале 3 заявок
	ASSIGN 2,0		* обнуляется 2-ой параметр
	TRANSFER ,ARM3

ARM3    QUEUE QARM3
	SEIZE ARM3
	DEPART QARM3
	ADVANCE FN1 
	RELEASE ARM3
	TEST E P3,1,MET4
	SAVEVALUE TRMNT3+,1	* счетчик завершенных заявок
	TRANSFER ,TRMN		* переход к завершению
MET4	TRANSFER .7,MET,RTER3	* с вероятностью 70% на терминал, иначе на KMM

MET	LINK LKMM,FIFO,KMM	* "очередь" к КММ (FIFO, ARM PRIOR = 10, CVK PRIOR = 5)

KMM	QUEUE QKMM
	SEIZE KMM
	DEPART QKMM
	ADVANCE FN2 
	RELEASE KMM
	UNLINK LKMM,KMM,1	* выход из "очереди" менее приоритетной заявки
	TEST E P2,0,BACK	* если P2=0 - в CVK, иначе на терминал
	TRANSFER ,CVK
BACK	TRANSFER ,FN4 

CVK	QUEUE QCVK
	SEIZE CVK
	DEPART QCVK
	PRIORITY 5		* приоритет для заявок на КММ
	ADVANCE 40,5
	ASSIGN 2,1		* P2=1 - значит, что заявка обработалась на ЦВК
	RELEASE CVK
	SAVEVALUE OBRCVK+,1	* счетчик обработанных заявок в CVK
	TEST L X$OBRCVK,300,END		* если достигли 300 - конец симуляции
	TRANSFER ,MET

TRMN	TERMINATE

END     TERMINATE 1
	START 1
	END
